<!DOCTYPE html>
<html class="dark" lang="pt">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Perfil - Midnight Circuit</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300..700&display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" rel="stylesheet"/>
    <link rel="stylesheet" href="style.css"/>
    <script src="utils.js"></script>
    <script>tailwind.config={darkMode:"class",theme:{extend:{colors:{primary:"rgb(var(--primary) / <alpha-value>)", "background-dark":"var(--bg-dark)", "surface-dark":"var(--surface)"},fontFamily:{"display":["Space Grotesk","sans-serif"]}}}}</script>
</head>
<body class="bg-background-dark text-gray-200 overflow-hidden">
    <div class="h-screen w-full flex flex-col overflow-y-auto">
        <div class="h-64 w-full bg-cover bg-center relative" id="visit-capa"><div class="absolute inset-0 bg-gradient-to-t from-background-dark to-transparent"></div><button onclick="history.back()" class="absolute top-4 left-4 bg-black/50 text-white px-4 py-2 rounded-full flex items-center gap-2"><span class="material-symbols-outlined">arrow_back</span> Voltar</button></div>
        <div class="max-w-4xl mx-auto px-4 relative -top-16 w-full">
            <div class="flex flex-col items-center text-center">
                <img id="visit-avatar" class="w-32 h-32 rounded-full border-4 border-background-dark object-cover shadow-2xl bg-surface-dark">
                <h1 id="visit-nome" class="text-3xl font-bold text-white mt-4">...</h1>
                <p id="visit-bio" class="text-gray-400 text-sm max-w-md mt-2">...</p>
                <div class="flex gap-4 mt-6">
                    <button onclick="window.location.href='chat.html'" class="px-6 py-2 bg-surface-dark border border-white/10 rounded-lg font-bold text-sm">Mensagem</button>
                    <button onclick="toggleSeguir()" id="btn-seguir" class="px-6 py-2 bg-primary text-white rounded-lg font-bold text-sm shadow-lg">Seguir</button>
                </div>
            </div>
            <div class="mt-12"><h3 class="text-xl font-bold text-white mb-4 border-b border-white/10 pb-2">Garagem</h3><div id="visit-carros" class="space-y-6"></div></div>
        </div>
    </div>
<script>
    const USUARIO_LOGADO = verificarLogin();
    const params = new URLSearchParams(window.location.search);
    const EMAIL_ALVO = params.get('email');
    if (!EMAIL_ALVO || EMAIL_ALVO === USUARIO_LOGADO.email) window.location.href = 'perfil.html';

    async function init() {
        try {
            const r = await fetch(`${URL_SERVIDOR}/perfil/dados?email=${EMAIL_ALVO}`);
            const u = await r.json();
            document.getElementById('visit-nome').innerText = u.nome;
            document.getElementById('visit-bio').innerText = u.bio || "Sem bio.";
            document.getElementById('visit-avatar').src = u.avatar || "https://i.pravatar.cc/150";
            document.getElementById('visit-capa').style.backgroundImage = `url('${u.capa}')`;
            
            // BotÃ£o Seguir
            const r2 = await fetch(`${URL_SERVIDOR}/perfil/dados?email=${USUARIO_LOGADO.email}`);
            const eu = await r2.json();
            if(eu.seguindo && eu.seguindo.includes(EMAIL_ALVO)) {
                document.getElementById('btn-seguir').innerText = "A Seguir";
                document.getElementById('btn-seguir').classList.replace('bg-primary', 'bg-white/20');
            }

            carregarCarros(u.nome);
        } catch(e){}
    }

    async function toggleSeguir(){
        await fetch(`${URL_SERVIDOR}/seguir`, { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({eu:USUARIO_LOGADO.email, ele:EMAIL_ALVO}) });
        location.reload();
    }

    async function carregarCarros(dono) {
        const r = await fetch(`${URL_SERVIDOR}/carros`); const c = await r.json();
        const lista = document.getElementById('visit-carros');
        const meus = c.filter(x=>x.dono === dono);
        if(meus.length===0) lista.innerHTML='<p class="text-center text-gray-500">Garagem vazia.</p>';
        meus.forEach(car=>{ lista.innerHTML+=`<div class="bg-surface-dark p-4 rounded-xl border border-white/10 flex gap-4"><div class="w-32 h-24 bg-cover bg-center rounded-lg" style="background-image:url('${car.imagemUrl}')"></div><div><h3 class="font-bold text-white text-lg">${car.modelo}</h3><p class="text-gray-400 text-sm">${car.specs.hp} HP</p></div></div>`; });
    }
    init();
</script></body></html>
